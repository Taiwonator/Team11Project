<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../../public/styles/navs.css">
    <link rel="stylesheet" href="../../public/styles/index.css">
    <title>Active Problems</title>
    
</head>
<body>

    <nav class='top-nav'>
        <div class="top-nav-left">
            <h2 class="top-nav-company">Make-It-All</h2>
        </div>
        <div class="top-nav-right">
            <h3 class="top-nav-text">Welcome Specialist</h3>
            <h3 class="top-nav-button"><a href="../../login.html">Logout</a></h3>
        </div>
    </nav>

    <nav id='specialist-side-nav'></nav>

    <div class="page">
        <div class="page-content scroll">
            <h1 class="title"><i class="fa fa-list"></i> Active Problems</h1>
            <div class="search-element">
                <h3 class="element-title">Active Problems</h3>
                <div class="search-element-bar">
                    <input type="text" placeholder="Enter name">
                    <button><i class="fa fa-search"></i></button>
                </div>
                <div class="search-element-table-wrapper">
                    <table class="search-element-table" id="active-problems-table">
                        <tr>
                            <th>Problem No.</th>
                            <th>Serial No.</th>
                            <th>Caller Name</th>
                            <th>Operator Name</th>
                            <th>Actions</th>
                        </tr>
                        <tr>
                            <td>0</td>
                            <td>1</td>
                            <td>Name</td>
                            <td>Name</td>
                            <td>
                                <button class="edit-button">View / Edit</button>
                                <button class="report-solved-button">Report Solved</button>
                            </td>
                        </tr>
                        <tr>
                            <td>1</td>
                            <td>0</td>
                            <td>Name</td>
                            <td>Name</td>
                            <td>
                                <button class="edit-button">View / Edit</button>
                                <button class="report-solved-button">Report Solved</button>
                            </td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>2</td>
                            <td>Name</td>
                            <td>Name</td>
                            <td>
                                <button class="edit-button">View / Edit</button>
                                <button class="report-solved-button">Report Solved</button>
                            </td>
                        </tr>
                    </table>
                </div>
                <button onclick="refreshPage()" class="big-button">Refresh</button>
            </div>
        </div>
        
        <div id="edit-screen" class="modal">
            <!-- Modal content -->
            <div class="modal-content">
              <span class="close">&times;</span>
              <h1 class="title"><i class="fa fa-edit"></i> View Problem</h1>
    
    
               <!-- DESCRIPTION -->
            <div class="text-area-input-element">
                <h3 class="element-title">Problem Description</h3>
                <textarea id="problem-description-input" class="scroll" disabled></textarea>
            </div>
    
            <!-- SOLVE METHOD -->
            <div class="text-area-input-element">
                <h3 class="element-title">How it was solved?</h3>
                <textarea id="solve-method-input" class="scroll"></textarea>
            </div>
    
            <!-- NOTES -->
            <div class="text-area-input-element">
                <h3 class="element-title">Notes</h3>
                <textarea id="notes-input" class="scroll"></textarea>
            </div>
    
            <!-- EQUIPMENT -->
            <div class="search-element">
                <h3 class="element-title">Equipment</h3>
                <div class="search-element-bar">
                    <input type="text" placeholder="Enter Serial Number" onkeyup="searchTable(event, 0)"> 
                    <button><i class="fa fa-search"></i></button>
                </div>
                <table id="equipment-table" class="search-element-table">
                    <tr>
                        <th>Serial No.</th>
                        <th>Type</th>
                        <th>Make</th>
                    </tr>
                    <tr>
                        <td>1234</td>
                        <td>Monitor</td>
                        <td>Asos</td>
                    </tr>
                </table>
            </div>
    
            <!-- SOFTWARE -->
            <div class="search-element">
                <h3 class="element-title">Software</h3>
                <div class="search-element-bar">
                    <input type="text" placeholder="Enter Software Name" onkeyup="searchTable(event, 0)"> 
                    <button><i class="fa fa-search"></i></button>
                </div>
                <table id="software-table" class="search-element-table">
                    <tr>
                        <th>Software Name</th>
                        <th>Licensed</th>
                        <th>Supported</th>
                    </tr>
                    <tr>
                        <td>Microsoft Word</td>
                        <td><i class="fa fa-check-square"></i></td>
                        <td><i class="fa fa-check-square"></i></td>
                    </tr>
                </table>
            </div>
    
            <!-- BRANCH -->
            <div class="search-element">
                <h3 class="element-title">Branch</h3>
                <div class="search-element-bar">
                    <input type="text" placeholder="Enter City" onkeyup="searchTable(event, 2)"> 
                    <button><i class="fa fa-search"></i></button>
                </div>
                <table id="branch-table" class="search-element-table">
                    <tr>
                        <th>Branch ID</th>
                        <th>Branch Name</th>
                        <th>City</th>
                        <th>Country</th>
                        <th>Telephone</th>
                    </tr>
                </table>
            </div>
    
            <!-- PROBLEM TYPE -->
            <div class="element-row">
                <div class="select-input-element">
                    <h3 class="element-title">Problem Type</h3>
                    <select id="problem-type-input" disabled> 
                        <option value="" selected disabled hidden>Select a problem type</option>
                        <optgroup label="Printer">
                            <option>Printer</option>
                            <option>Printer Ink</option>
                            <option>Printer Paper</option>
                        </optgroup>
                        <optgroup label="Hardware">
                            <option>Hardware</option>
                            <option>GPU</option>
                            <option>RAM</option>
                        </optgroup>
                    </select>
                </div>
    
                <!-- OS -->
                <div class="select-input-element">
                    <h3 class="element-title">Operating System</h3>
                    <select id="os-input" disabled>
                        <option value="" selected disabled hidden>Select an OS</option>
                        <option>Windows</option>
                        <option>iOS</option>
                        <option>Linux</option>
                        <option value="">Doesn't require OS</option>
                    </select>
                </div>
            </div>
    
            <!-- PRIORITY -->
            <div class="element-row">
                <div class="select-input-element">
                    <h3 class="element-title">Priority</h3>
                    <select id="priority-input" disabled>
                        <option value="" selected disabled hidden>Select Priority</option>
                        <option>Low</option>
                        <option>Medium</option>
                        <option>High</option>
                        <option value="">I don't know</option>
                    </select>
                </div>
    
                <!-- DATE -->
                <div class="date-input-element">
                    <h3 class="element-title">Date</h3>
                    <input id="date-solved-input" type="date" disabled>
                </div>
            </div>
    
            <!-- IN PERSON -->
            <div class="checkbox-input-element">
                <h3 onclick="getInputs()" class="element-title">In Person Solving</h3>
                <input type="checkbox" id="in-person-input" value="in-person" disabled>
                <label>Problem must be solved in person</label>
            </div>
            <button id="exit-button" class="big-button confirm-edit">Exit</button>
            </div>
    
              
            </div>
        </div>
    
        <script src="../../public/js/ajaxFunctions.js"></script>
        <script>
    
            var data = {};
            var activeProblemsTable = document.getElementById("active-problems-table");
            var modal = document.getElementById("edit-screen");
            var span = document.getElementsByClassName("close")[0]; // close button
    
            var problemDescriptionInput = document.getElementById("problem-description-input");
            var solveMethodInput = document.getElementById("solve-method-input");
            var notesInput = document.getElementById("notes-input");
            var equipmentTable = document.getElementById("equipment-table");
            var softwareTable = document.getElementById("software-table");
            var branchTable = document.getElementById("branch-table");
            var problemTypeInput = document.getElementById("problem-type-input");
            var osInput = document.getElementById("os-input");
            var priorityInput = document.getElementById("priority-input");
            var dateSolvedInput = document.getElementById("date-solved-input");
            var inPersonInput = document.getElementById("in-person-input");

    
            span.onclick = function() {
                modal.style.display = "none";
            }
    
            document.getElementById("exit-button").onclick = function() {
                modal.style.display = "none";
            }

            function refreshPage() {
                location.reload();
            }
    
            function loadActiveSolutions() {
                loadData('GET', '../php/activeProblems/sql_select_activeProblems.php', {}, function(json){
                    data.activeProblems = JSON.parse(json);
                    console.log(data);
    
                    activeProblemsTable.innerHTML = `<tr> 
                                                          <th>Problem No.</th>
                                                          <th>Problem Description</th>
                                                          <th>Solve Method</th>
                                                          <th>Notes</th>
                                                          <th>Actions</th>
                                                        </tr>
                                                        ${generateActiveSolutionsTable(json)}`;
    
                })
            }
            loadActiveSolutions();
            loadBranches();
            loadEquipment();
            loadSoftware();
            loadSpecialists();
            loadExternalSpecialists();
            loadProblemTypes();
    
            function loadBranches() {
                loadData('GET', '../../public/php/sql_select_branches.php', {}, function(json){
                    data.branches = JSON.parse(json);
                    console.log(data);
                })
            }
    
            function loadEquipment() {
                loadData('GET', '../../public/php/sql_select_equipment.php', {}, function(json){
                    data.equipment = JSON.parse(json);
                    console.log(data);
                })
            }
    
            function loadSoftware() {
                loadData('GET', '../../public/php/sql_select_software.php', {}, function(json){
                    data.software = JSON.parse(json);
                    console.log(data);
                })
            }
    
            function loadSpecialists() {
                loadData('GET', '../../public/php/sql_select_specialists.php', {}, function(json){
                    data.specialists = JSON.parse(json);
                    console.log(data);
                })
            }
    
            function loadExternalSpecialists() {
                loadData('GET', '../../public/php/sql_select_externalSpecialists.php', {}, function(json){
                    data.externalSpecialists = JSON.parse(json);
                    console.log(data);
                })
            }

            function loadProblemTypes() {
                loadData('GET', '../../public/php/sql_select_problemType.php', {}, function(json){
                    data.problemTypes = JSON.parse(json);
                    console.log(data);
                    problemTypeInput.innerHTML = generateProblemTypesDropdown();
                })
            }
    
            function generateActiveSolutionsTable(json) {
                return generateTable(json, (problem) => {
                    return `<tr>
                                <td>${problem.problemNumber}</td>
                                <td>${problem.description}</td>
                                <td>${problem.solveMethod}</td>
                                <td>${problem.notes}</td>
                                <td>
                                    <button onclick="viewProblem(${problem.problemNumber})" class="edit-button">Edit / Reassign</button>
                                    <button onclick="reportSolved(${problem.problemNumber})" class="report-solved-button">Report Solved</button>
                                </td>`
                })
            }
    
            function generateEquipmentTable(serialNumber) {
                    let output = ``;
                    for(var i = 0; i < data.equipment.length; i++) {
                        if(data.equipment[i].serialNumber == serialNumber) {
    
                            let equipment = data.equipment[i];
                            output += `<tr class="selected-row">
                                        <td>${equipment.serialNumber}</td>
                                        <td>${equipment.type}</td>
                                        <td>${equipment.make}</td>
                                    </tr>`;
    
                        } else {
                            let equipment = data.equipment[i];
                            output += `<tr>
                                        <td>${equipment.serialNumber}</td>
                                        <td>${equipment.type}</td>
                                        <td>${equipment.make}</td>
                                    </tr>`;
                        }
                    }
                    return output;
                
            }
    
            function generateSoftwareTable(softwareName) {
                    let output = ``;
                    for(var i = 0; i < data.software.length; i++) {
                        if(data.software[i].softwareName == softwareName) {
    
                            let software = data.software[i];
                            output += `<tr class="selected-row">
                                        <td>${software.softwareName}</td>
                                        ${(software.licensed == 1) ? '<td><i class="fa fa-check-square"></i></td>' : '<td></td>'}
                                        ${(software.supported == 1) ? '<td><i class="fa fa-check-square"></i></td>' : '<td></td>'}
                                    </tr>`;
    
                        } else {
                            let software = data.software[i];
                            output += `<tr>
                                        <td>${software.softwareName}</td>
                                        ${(software.licensed == 1) ? '<td><i class="fa fa-check-square"></i></td>' : '<td></td>'}
                                        ${(software.supported == 1) ? '<td><i class="fa fa-check-square"></i></td>' : '<td></td>'}
                                    </tr>`;
                        }
                    }
                    return output;
                
            }
    
            function generateBranchTable(branchID) {
                    let output = ``;
                    for(var i = 0; i < data.branches.length; i++) {
                        if(data.branches[i].id == branchID) {
    
                            let branch = data.branches[i];
                            output += `<tr class="selected-row">
                                        <td>${branch.id}</td>
                                        <td>${branch.name}</td>
                                        <td>${branch.city}</td>
                                        <td>${branch.country}</td>
                                        <td>${branch.telephone}</td>
                                    </tr>`;
    
                        } else {
                            let branch = data.branches[i];
                            output += `<tr>
                                        <td>${branch.id}</td>
                                        <td>${branch.name}</td>
                                        <td>${branch.city}</td>
                                        <td>${branch.country}</td>
                                        <td>${branch.telephone}</td>
                                    </tr>`;
                        }
                    }
                    return output;
            }
    

            function generateProblemTypesDropdown() {    
                var problemTypes = ``;
                for(var i = 0; i < data.problemTypes.length; i++) {
                    problemTypes += `<option>${data.problemTypes[i].problemType}</option>`;
                }

                let out = `select id="problem-type-input"> 
                                ${problemTypes}
                            </select>`;     
                return out;          
            }
    
            function reportSolved(problemNumber) {
                var confirmed = confirm("Are you sure you want to report this problem solved?");
                if(confirmed) {
                    updateProblemStatus(problemNumber);
                }
            }
    
            function updateProblemStatus(problemNumber) {
                // CALL PHP FILE
                alert(`Problem ${problemNumber} reported`);
            }
    
            function viewProblem(problemNumber) {
                console.log(problemNumber);
                
                // Open modal
                modal.style.display = "block";
    
                // Get all input objects 
                for(var i = 0; i < data.activeProblems.length; i++) {
                    if(data.activeProblems[i].problemNumber == problemNumber) {
                        setInputs(data.activeProblems[i]);
                    }
                }
    
    
                // Set all values
            }
    
            function setInputs(problem) {
                console.log(problem);
    
                // Text fields
                setTextInput(problemDescriptionInput, problem.description);
                setTextInput(solveMethodInput, problem.solveMethod);
                setTextInput(notesInput, problem.notes);
                setTextInput(problemTypeInput, problem.problemType);
                setTextInput(osInput, problem.OS);
                setTextInput(priorityInput, problem.priority);
                setTextInput(dateSolvedInput, problem.dateSolved);        
    
                // Tables
                equipmentTable.innerHTML = `<tr>
                                                <th>Serial No.</th>
                                                <th>Type</th>
                                                <th>Make</th>
                                            </tr>
                                            ${generateEquipmentTable(problem.serialNumber)}`;
                softwareTable.innerHTML = `<tr>
                                                <th>Software Name</th>
                                                <th>Licensed</th>
                                                <th>Supported</th>
                                            </tr>
                                            ${generateSoftwareTable(problem.softwareName)}`;
                branchTable.innerHTML = `<tr>
                                                <th>Branch ID</th>
                                                <th>Branch Name</th>
                                                <th>City</th>
                                                <th>Country</th>
                                                <th>Telephone</th>
                                            </tr>
                                            ${generateBranchTable(problem.branchID)}`;
    
                // Checkbox
                if(problem.inPerson == "1") {
                    inPersonInput.checked = true;
                } else {
                    inPersonInput.checked = false;
                }
                
                // Retreive the search element
    
                // Genertae all the specialists and external specialists but hide the one which the specialist isn't
                // Add checkbox with same id everytime so you can check if onclick....
            }
    
            function setTextInput(input, value) {
                if(value != null) {
                    input.value = value;
                    console.log(input, value);
                } else {
                    input.value = "";
                }
            }   
            
            function getInputs() {
                var inputs = {
                    solveMethod: solveMethodInput.value, 
                    notes: notesInput.value, 
                }
                const validatedInputs = validateInputs(inputs);
                console.log(validatedInputs);
            }

            function validateInputs(inputs) {
                if(inputs.solveMethod == null || inputs.solveMethod.length == 0) {
                    return "solve method is empty";
                } else {
                    return inputs;
                }
            }
    
        </script>

    <script src="../../public/js/navs.js"></script>
    <script src="../../public/js/cssHelpers.js"></script>
</body>
</html>